<!doctype html>
  <script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<html style="font-size: 16px;" lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Post 1 Headline">
    <meta name="description" content="">
    <title>Generative Model</title>
    <link rel="stylesheet" href="../nicepage.css" media="screen">
<link rel="stylesheet" href="../Post-Template.css" media="screen">
    <script class="u-script" type="text/javascript" src="../jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="../nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 4.14.1, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "",
		"logo": "images/owanlogo.png",
		"sameAs": [
				"https://www.facebook.com/owan.naruemit",
				"https://twitter.com/napanaruemit",
				"https://www.linkedin.com/in/pethai-napanaruemit-3a69a7190/",
				"https://github.com/pethai2004",
				"https://www.youtube.com/channel/UCkQZQFB-PPBgNEL-GizSucw"
		]
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta name="twitter:site" content="@">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Post Template">
    <meta name="twitter:description" content="">
  </head>
  <body class="u-body u-xl-mode" data-lang="en"><header class="u-clearfix u-header u-palette-1-light-2 u-header" id="sec-b8de"><div class="u-clearfix u-sheet u-sheet-1">
        <a href="../Home.html" data-page-id="208602995" class="u-image u-logo u-image-1" data-image-width="1000" data-image-height="1000" title="Home">
          <img src="../images/owanlogo.png" class="u-logo-image u-logo-image-1">
        </a>
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px; font-weight: 700;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg class="u-svg-link" viewBox="0 0 24 24"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="../Home.html" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="../project-and-code.html" style="padding: 10px 20px;">project and code</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="../lecture.html" style="padding: 10px 20px;">lecture</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="../Home.html">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="../project-and-code.html">project and code</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="../lecture.html">lecture</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div></header>
    <section class="u-align-center u-clearfix u-section-1" id="sec-bf54">
      <div class="u-clearfix u-sheet u-valign-middle-md u-valign-middle-sm u-valign-middle-xs u-sheet-1"><!--post_details--><!--post_details_options_json--><!--{"source":""}--><!--/post_details_options_json--><!--blog_post-->
        <div class="u-container-style u-expanded-width u-post-details u-post-details-1">
          <div class="u-container-layout u-valign-middle u-container-layout-1", style= "position: center;padding: 0px 100px 5px 100px;"><!--blog_post_image-->
            <!--/blog_post_image--><!--blog_post_header-->
            <h2 class="u-blog-control u-text u-text-1">Generative Model</h2><!--/blog_post_header--><!--blog_post_metadata-->
            <div class="u-blog-control u-metadata u-metadata-1"><!--blog_post_metadata_date-->
              <span class="u-meta-date u-meta-icon">Aug 01, 2022</span><!--/blog_post_metadata_date--><!--blog_post_metadata_category-->
              <!--/blog_post_metadata_category--><!--blog_post_metadata_comments-->
              <!--/blog_post_metadata_comments-->
            </div><!--/blog_post_metadata--><!--blog_post_content-->
            
<div style= "position: center;"><p>The most general case is given the set \(x\) of real sample data (e.g. image), the goal is to generate another set of data by some function generally neural network which is similar to real samples. We aim, in other word, given generated data \( x\sim p_{g}( z)\) of some latent \(\ z\) that minimize kl-divergence, \(\ D_{KL}( p_{g}( z) ||p_{r}( x))\) where \(p_{r}\) is real sampled dataset.



In order to obtain such generator \( G\), we use adversarial training (GANs, Ian Goodfellow 2016) by having another discrimminator \((\ \mathbb{R}^{n}\rightarrow \mathbb{R} :D\) which assign value of the probability of either real sample or generated one. Intuitively, generator \( G\) aim to minimize or "faking" discrimminator that the its fake generated output is "real". And discriminator must assign low probability to fake generated output, ideally zero.



According to original GANs papers, this can be formulated as minimax game where, given the objective \(\ f\), we try to both minimize and maximize it at the same time. Note also that during gradient updation, the first term do no effect \(\ G\).
\begin{equation}
\mathbf{\underset{G}{\mathbf{m} in} \ \underset{D}{\mathbf{m} ax}} \ f( D,G) =\mathbb{E}_{x\sim p_{r}( x)}[\log p_{r}( x)] +\mathbb{E}_{x\sim p_{g}( x)}[\log( 1-D( x))]
\end{equation}
</p>

<p>
Now, imagine we have optimal \(D\) and \(G\) is fixed, then what should the value of \(D\) be? This first would mean that the KL-divergence approach zero, \(\ p_{r} =p_{g}\), which also make \(G\) also approach \(\ 1/2\) given that the input is normally distributed with fake and real sample sets. This also can be seen by algebraically solve the optimal value of \(\ D\) by finding the derivative of objective \(\ f\) with respect to discrimminator \(\ D\), set it to zero and solve for optimal \(\ D^{*}\):
\begin{gather}
f( D) =\int _{x} p_{r}( x)\log D( x) +p_{g}( x)\log( 1-D( x)) dx\\
\frac{df( D)}{dD} =p_{r}( x)\frac{1}{\ln 10}\frac{1}{p_{r}( x)} -p_{g}( x)\frac{1}{\ln 10}\frac{1}{1-p_{r}( x)} =0\\
D^{*}( x) =\frac{p_{r}( x)}{p_{r}( x) +p_{g}( x)} =\frac{1}{2}
\end{gather}
Now if we also have both optimal \(\ G\) and \(\ D\), \(\ p_{r} =p_{g}\) and \(\ D^{*}( x) =1/2\) then, plug this value in give us the optimal value of objective function of \(\ f\left( D^{*} ,G\right) =-2\log 2\). By Jensenâ€“Shannon divergence \(\ D_{SH}\):
\begin{gather}
D_{SH} =\frac{1}{2} D_{KL}\left( p_{r}\Bigl|\Bigl|\frac{p_{r} +p_{g}}{2}\right) +\frac{1}{2} D_{KL}\left( p_{g}\Bigl|\Bigl|\frac{p_{r} +p_{g}}{2}\right)\\
=\ 1/2\left(\log 4+f\left( G,D^{*}\right)\right)\\
f\left( D^{*} ,G\right) =2D_{SH}( p_{r} ||p_{g}) -2\log 2
\end{gather}
And that the first term vanish left only second term, \(\ 2D_{SH}( p_{r} ||p_{g}) =0\).



Note that we can will training GANs also by Maximum Likelihood where given some known \(\ p_{r}\) and initial guess of \(\ p_{g}\), meaning that \(\ p_{g}( x)  >0\) for all \(\ x\) and must integrate to one. This is directly learn probability distribution. The second way is we learn function that transform some variable \(\ Z\) to \(\ p_{g}\) where \(\ z\in Z\) come from tractable family of distributions. Indeed, first approach is intractable since its objective is equivalent to KL-divergence of these two distributions. 
</p>



<h4>Some training issue</h4>
<p>
This training GANs is non-cooperative game where each player is trying to maximize its own objective. These two model \(\ G\) and \(\ D\) try to find its Nash-Equilibrium of two-player non-cooperative game. \href{https://arxiv.org/abs/1904.08994}{Weng} has a nice example illustration on this, imagine an objective \(\ f=xy\) where we simultaneously maximize \(\ \mathbf{max}_{x} f\) and minimize \(\ \mathbf{min}_{y} f\). Updating this using \(\ x_{k+1}\leftarrow x_{k} +ay\) and \(\ y_{k+1}\leftarrow y_{k} -ax\) will couse a huge oscillation in time both for value of \(\ x\), \(\ y\) and also the objective \(\ f\). This cause training the GANs to be instability and hard to converge to optimal value.



And if, however, the discriminator doing "too well" on the task but not the generator. The probability then \(\ D( x) =1\) for \(\ x\sim p_{r}\) and \(\ 0\) for \(\ x\sim p_{g}\). This also couse the gradient approach zero and no value is been updated or very slow (see more <a href="https://arxiv.org/pdf/1701.04862">Arjovsky</a>). If discriminator doing "not well", the generator cannot receive true feedback and having no preference where the gradient update should go. For more detail to improve training GANs 
</p>
see more on <a href="https://lilianweng.github.io/posts/2017-08-20-gan/">(1)</a>
<a href="https://proceedings.neurips.cc/paper/2016/file/8a3363abe792db2d8761d6403605aeb7-Paper.pdf">(2)</a>

<h4>WGANs objective</h4>
<p>
The Wasserstein or Earth mover's distance (EM) is a probabilitistic distance, according to <a href="https://en.wikipedia.org/wiki/Earth\_mover">this</a>, it is interpreted as minimum cost of moving a pile of dirt to another hole where the cost here is the amount of dirt and distance. In continuous case EM is formulated as:
\begin{equation}
D_{EM}( p_{r} ||p_{g}) =\inf_{\beta \sim \prod ( p_{r} ,p_{g})}\mathbb{E}_{x,y\sim \beta }[\Vert x-y\Vert ]
\end{equation}
In discrete space, imagine some distribution \(\ p_{u} =\{3,1,3,5\}\) and another \(\ p_{v} =\{1,2,4,5\}\). The pile to move here is sum over all mimimum moves to make \(\ p_{u} =p_{v}\). There are many way to adding/subtracting one from another to make these distribution similar. But we only want the least way to do it as the EM use infimum (greatest lower bound) over joint \(\ p_{r}\) and \(\ p_{g}\) or its minimum distance. The minimum cost in this case here is \(\ p_{u}^{1}\rightarrow p_{v}^{1} =1\) and then \(\ \ p_{v}^{2}\rightarrow p_{u}^{3} =1\). The distance is then \(\ D_{EM} =\sum _{i}| \delta _{i}| =1+1=2\). In continuous case, the amount dirt move is its joint \(\ \prod ( p_{r} ,p_{g})\) and distance of \(  x-y\Vert \), so the total cost is \(\prod (p_{r} ,p_{g})\Vert x-y\Vert \). The cost for over all pairs of \(\ ( x,y)\) is 
\begin{equation}
\sum _{x,y} \beta ( x,y)\Vert x-y\Vert =\mathbb{E}_{x,y\sim \beta }[\Vert x-y\Vert ]
\end{equation}
In practice, we cannot use an exhaustive search for every possible joint of \(\ p_{r}\) and \(\ p_{g}\) and also find its infimum. Note that I also use \(\ f\) for parametrized function. Kantorovich-Rubinstein Duality transform this EM into new one:
\begin{equation}
E_{EM} =\frac{1}{K}\sup _{|f|_{L} \geqslant K}\mathbb{E}_{x\sim p_{r}}[ f( x)] -\mathbb{E}_{x\sim p_{g}}[ f( x)]
\end{equation}
See <a href="https://courses.cs.washington.edu/courses/cse599i/20au/resources/L12\_duality.pdf">this</a> for detailed proof. The objective \(\ f\) is \(\ K\)-Lipschitz continuous is differentiable and is bounded where there exist a constant \(\ K\geqslant 0\) such that for all scalar \(\ x_{0}\) and \(\ x_{1}\): \(\ |f( x_{o}) -f( x_{1}) |\leqslant K|x_{0} -x_{1} |\). This is saying that the function \(\ f\) should not change "too" quick or its derivative is too big. The change in objective is then :
\begin{equation}
L=\max_{\theta }\frac{1}{K}\sum _{k=0}^{K} f_{w}\left( x^{k}\right) -\frac{1}{K}\sum _{k=0}^{K} f_{w}\left( g_{\theta }\left( z^{k}\right)\right)
\end{equation}
We could use gradient clipping after updating or gradient penaltry in objective as \(\ f=L+\lambda ( |\nabla D( x) |_{2} -1)^{2}\).

This post have a nice explanation for WGANs 
<a href="https://vincentherrmann.github.io/blog/wasserstein/"WGANs></a>
<a href="https://arxiv.org/pdf/1704.00028.pdf">training technique</a>
<a href="https://proceedings.neurips.cc/paper/2016/file/8a3363abe792db2d8761d6403605aeb7-Paper.pdf">(1)</a>
<a href="orginal papers (WGAN): https://arxiv.org/pdf/1701.07875.pdf">Gans</a>

</p>

<h4>More efficient way to find latent space \( p( z)\) AutoEncoder and VAE</h4>

<p>
Generic GANs only consider mapping from latent space distributed from some tractable familty of distribution. But such latent space, even having good generator, may not be a good representation and the generator will not preduce data that similar to true distributions. AE reconstruct original input while compressing the data in to latent space \( z\) before feeding to upsampling layers of the convolutional network. VAE, like AE but only not mapping to fixed vector but distribution. VAE sample \( x\) from conditional \( p_{\theta }( x|z)\) as
\begin{equation}
p_{\theta }( x) =\int p_{\theta }( x|z) p_{\theta }( z) dz
\end{equation}
and, from my previous post on VAE, we approximate this integral by consider log-likelihood function \( p_{\theta }( x)\) (see my previous post for more detailed derivation) :
\begin{equation}
\log p_{\theta }( x) =\mathbb{E}_{z\sim q_{\omega }( z|x)}[\log \ p_{\theta }( x|z)] -D_{KL}( q_{\omega }( z|x) ||p_{\theta }( z)) +D_{KL}( q_{\omega }( z|x) ||q_{\theta }( z|x))
\end{equation}
since kl-divergence is always non negative, we have that 
\begin{gather}
\log p_{\theta }( x) \geqslant \mathbb{E}_{z\sim q_{\omega }( z|x)}[\log \ p_{\theta }( x|z)] -D_{KL}( q_{\omega }( z|x) ||p_{\theta }( z))\\
=ELBO( x;\theta ;\omega )
\end{gather}
In word, we normally maximizing likelihood \( p_{\theta }( x)\) which is true distribution that generate data and is unknown. But we have ELBO which is tractable thus we the objective function of VAE is 
\begin{equation}
\dot{x} =\mathbf{argmax}_{x} ELBO( x;\theta ;\omega )
\end{equation}
</p>
</div>

          </div>
        </div><!--/blog_post--><!--/post_details-->
      </div>
    </section>
    
    
    <footer class="u-clearfix u-footer u-grey-80" id="sec-e381"><div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-align-left u-social-icons u-spacing-10 u-social-icons-1">
          <a class="u-social-url" title="facebook" target="_blank" href="https://www.facebook.com/owan.naruemit"><span class="u-icon u-social-facebook u-social-icon u-icon-1"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 112 112" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-9909"></use></svg><svg class="u-svg-content" viewBox="0 0 112 112" x="0" y="0" id="svg-9909"><circle fill="currentColor" cx="56.1" cy="56.1" r="55"></circle><path fill="#FFFFFF" d="M73.5,31.6h-9.1c-1.4,0-3.6,0.8-3.6,3.9v8.5h12.6L72,58.3H60.8v40.8H43.9V58.3h-8V43.9h8v-9.2
            c0-6.7,3.1-17,17-17h12.5v13.9H73.5z"></path></svg></span>
          </a>
          <a class="u-social-url" title="twitter" target="_blank" href="https://twitter.com/napanaruemit"><span class="u-icon u-social-icon u-social-twitter u-icon-2"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 112 112" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-d07a"></use></svg><svg class="u-svg-content" viewBox="0 0 112 112" x="0" y="0" id="svg-d07a"><circle fill="currentColor" class="st0" cx="56.1" cy="56.1" r="55"></circle><path fill="#FFFFFF" d="M83.8,47.3c0,0.6,0,1.2,0,1.7c0,17.7-13.5,38.2-38.2,38.2C38,87.2,31,85,25,81.2c1,0.1,2.1,0.2,3.2,0.2
            c6.3,0,12.1-2.1,16.7-5.7c-5.9-0.1-10.8-4-12.5-9.3c0.8,0.2,1.7,0.2,2.5,0.2c1.2,0,2.4-0.2,3.5-0.5c-6.1-1.2-10.8-6.7-10.8-13.1
            c0-0.1,0-0.1,0-0.2c1.8,1,3.9,1.6,6.1,1.7c-3.6-2.4-6-6.5-6-11.2c0-2.5,0.7-4.8,1.8-6.7c6.6,8.1,16.5,13.5,27.6,14
            c-0.2-1-0.3-2-0.3-3.1c0-7.4,6-13.4,13.4-13.4c3.9,0,7.3,1.6,9.8,4.2c3.1-0.6,5.9-1.7,8.5-3.3c-1,3.1-3.1,5.8-5.9,7.4
            c2.7-0.3,5.3-1,7.7-2.1C88.7,43,86.4,45.4,83.8,47.3z"></path></svg></span>
          </a>
          <a class="u-social-url" title="linkedin" target="_blank" href="https://www.linkedin.com/in/pethai-napanaruemit-3a69a7190/"><span class="u-icon u-social-icon u-social-linkedin u-icon-3"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 112 112" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-694a"></use></svg><svg class="u-svg-content" viewBox="0 0 112 112" x="0" y="0" id="svg-694a"><circle fill="currentColor" cx="56.1" cy="56.1" r="55"></circle><path fill="#FFFFFF" d="M41.3,83.7H27.9V43.4h13.4V83.7z M34.6,37.9L34.6,37.9c-4.6,0-7.5-3.1-7.5-7c0-4,3-7,7.6-7s7.4,3,7.5,7
            C42.2,34.8,39.2,37.9,34.6,37.9z M89.6,83.7H76.2V62.2c0-5.4-1.9-9.1-6.8-9.1c-3.7,0-5.9,2.5-6.9,4.9c-0.4,0.9-0.4,2.1-0.4,3.3v22.5
            H48.7c0,0,0.2-36.5,0-40.3h13.4v5.7c1.8-2.7,5-6.7,12.1-6.7c8.8,0,15.4,5.8,15.4,18.1V83.7z"></path></svg></span>
          </a>
          <a class="u-social-url" target="_blank" data-type="Github" title="Github" href="https://github.com/pethai2004"><span class="u-icon u-social-github u-social-icon u-icon-4"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 112 112" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-a39c"></use></svg><svg class="u-svg-content" viewBox="0 0 112 112" x="0" y="0" id="svg-a39c"><circle fill="currentColor" cx="56.1" cy="56.1" r="55"></circle><path fill="#FFFFFF" d="M88,51.3c0-5.5-1.9-10.2-5.3-13.7c0.6-1.3,2.3-6.5-0.5-13.5c0,0-4.2-1.4-14,5.3c-4.1-1.1-8.4-1.7-12.7-1.8
	c-4.3,0-8.7,0.6-12.7,1.8c-9.7-6.6-14-5.3-14-5.3c-2.8,7-1,12.2-0.5,13.5C25,41.2,23,45.7,23,51.3c0,19.6,11.9,23.9,23.3,25.2
	c-1.5,1.3-2.8,3.5-3.2,6.8c-3,1.3-10.2,3.6-14.9-4.3c0,0-2.7-4.9-7.8-5.3c0,0-5-0.1-0.4,3.1c0,0,3.3,1.6,5.6,7.5c0,0,3,9.1,17.2,6
	c0,4.3,0.1,8.3,0.1,9.5h25.2c0-1.7,0.1-7.2,0.1-14c0-4.7-1.7-7.9-3.4-9.4C76,75.2,88,70.9,88,51.3z"></path></svg></span>
          </a>
          <a class="u-social-url" target="_blank" data-type="YouTube" title="YouTube" href="https://www.youtube.com/channel/UCkQZQFB-PPBgNEL-GizSucw"><span class="u-icon u-social-icon u-social-youtube u-icon-5"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 112 112" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-7985"></use></svg><svg class="u-svg-content" viewBox="0 0 112 112" x="0" y="0" id="svg-7985"><circle fill="currentColor" cx="56.1" cy="56.1" r="55"></circle><path fill="#FFFFFF" d="M74.9,33.3H37.3c-7.4,0-13.4,6-13.4,13.4v18.8c0,7.4,6,13.4,13.4,13.4h37.6c7.4,0,13.4-6,13.4-13.4V46.7 C88.3,39.3,82.3,33.3,74.9,33.3L74.9,33.3z M65.9,57l-17.6,8.4c-0.5,0.2-1-0.1-1-0.6V47.5c0-0.5,0.6-0.9,1-0.6l17.6,8.9 C66.4,56,66.4,56.8,65.9,57L65.9,57z"></path></svg></span>
          </a>
        </div>
        <div class="u-border-1 u-border-white u-expanded-width u-line u-line-horizontal u-opacity u-opacity-50 u-line-1"></div>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <a class="u-link" href="https://nicepage.com/website-templates" target="_blank">
        <span>Website Templates</span>
      </a>
      <p class="u-text">
        <span>created with</span>
      </p>
      <a class="u-link" href="" target="_blank">
        <span>Website Builder Software</span>
      </a>. 
    </section>
  
</body></html>